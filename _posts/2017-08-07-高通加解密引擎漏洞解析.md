---
title: 高通加解密引擎提权漏洞解析
data: 2017-08-07 15:39:00
---

author : <a href="https://twitter.comengjia4574" target="_blank">jiayy(@chengjia4574)</a>  and <a href="http://weibo.com/jfpan" target="_blank">@pjf_</a> of IceSword Lab , Qihoo 360

----------
## 前言
CVE-2016-3935 和 CVE-2016-6738 是<a href="http://www.iceswordlab.com/">我们</a>发现的高通加解密引擎（Qualcomm crypto engine）的两个提权漏洞，分别在2016年<a href="https://source.android.com/security/bulletin/2016-10-01">10月</a>和<a href="https://source.android.com/security/bulletin/2016-11-01">11月</a>的谷歌android漏洞榜被公开致谢，同时高通也在2016年<a href="https://www.codeaurora.org/failed-integer-overflow-check-leads-heap-overflow-driver-devqce-cve-2016-3901-cve-2016-3935">10月</a>和<a href="https://www.codeaurora.org/user-controlled-arbitrary-kernel-address-write-qcedev-driver-cve-2016-6738">11月</a>的漏洞公告里进行了介绍和公开致谢。这两个漏洞报告给谷歌的时候都提交了exploit并且被采纳，这篇文章介绍一下这两个漏洞的成因和利用。

## 背景知识
高通芯片提供了硬件加解密功能，并提供配套驱动给内核态和用户态程序提供高速加解密服务，主要有3个驱动

    * qce driver:  与加解密芯片交互，提供加解密驱动底层接口
    * qcrypto driver:  供内核态程序使用的加解密接口 
    * qcedev driver: 供用户态程序使用的加解密接口

![](img-2017-08-07/qcetxt.png)

<a href="https://android.googlesource.com/kernel/msm.git/+/3f2bc4d6eb5a4fada842462ba22bb6bbb41d00c7/Documentation/crypto/msm/qcedev.txt">qcedev driver</a>就是本文两个漏洞发生的地方，这个驱动通过 ioctl 接口为用户层提供加解密和哈希运算服务。
